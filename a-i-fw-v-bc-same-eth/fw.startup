ifconfig eth0 1.1.1.1/24
ifconfig eth1 2.2.2.1/24
route add -net 3.3.3.0/24 gw 1.1.1.2

iptables -t filter -P INPUT DROP
iptables -t filter -P OUTPUT DROP
iptables -t filter -P FORWARD DROP

iptables -A INPUT -p icmp --icmp-type echo-request -j ACCEPT
iptables -A OUTPUT -p icmp --icmp-type echo-reply -j ACCEPT

iptables -A FORWARD -i eth0 -o eth2 -p tcp --syn --dport 6000 -m conntrack --ctstate NEW -j ACCEPT

iptables -A FORWARD -i eth1 -o eth1 -s 2.2.2.2 -d 2.2.2.3 -p tcp --syn --dport 3000 -m conntrack --ctstate NEW -j ACCEPT

iptables -A FORWARD -i eth1 -o eth0 -s 2.2.2.2 -p tcp --syn --dport 80 -m conntrack --ctstate NEW -j ACCEPT

iptables -A FORWARD -i eth0 -o eth1 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -i eth1 -o eth0 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -i eth0 -o eth2 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -i eth2 -o eth2 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT
iptables -A FORWARD -i eth1 -o eth1 -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT

iptables -t nat -A PREROUTING -i eth0 -p tcp --dport 6000 -j DNAT --to-destination 4.4.4.2

iptables -t nat -A PREROUTING -i eth1 -s 2.2.2.2 -p tcp --dport 6000 -j DNAT --to-destination 4.4.4.2

iptables -t nat -A PREROUTING -i eth1 -s 2.2.2.2 -p tcp --dport 3000 -j DNAT --to-destination 2.2.2.3

iptables -t nat -A POSTROUTING -o eth0 -j SNAT --to-source 1.1.1.1
